‚∏ª

üî¥ PROMOTIONS & DISCOUNTS ‚Äî PERSISTENCE + WIRING (NO NEW FEATURES)

‚ö†Ô∏è READ THIS FIRST ‚Äî FAILURE CONDITIONS

You are NOT allowed to:
	‚Ä¢	Use Zustand, localStorage, or in-memory state for promotions
	‚Ä¢	Mark any feature as ‚Äúworking‚Äù without logout/login verification
	‚Ä¢	Add new promo types, UI redesigns, or ‚Äúfuture improvements‚Äù
	‚Ä¢	Touch payments, Paystack, checkout APIs, or order creation
	‚Ä¢	Change existing UI layouts unless required to unblock functionality
	‚Ä¢	Report success without manual testing using the credentials below

If any of the above occurs, the task is FAILED.

‚∏ª

üéØ OBJECTIVE

Fix the existing Promotions & Discounts system so it is:
	‚Ä¢	Fully database-backed
	‚Ä¢	Vendor-owned
	‚Ä¢	Persistent across logout / login
	‚Ä¢	Selectable from live vendor inventory
	‚Ä¢	Visible to Admin
	‚Ä¢	Readable by Checkout (read-only for now)

This task is FOUNDATIONAL and must be completed before payments.

‚∏ª

üß© CURRENT STATE (CONFIRMED)

Vendor Promotions UI (EXISTS)
	‚Ä¢	Coupons tab:
	‚Ä¢	Code
	‚Ä¢	Name
	‚Ä¢	Type (% / fixed)
	‚Ä¢	Value
	‚Ä¢	Min order
	‚Ä¢	Usage limit
	‚Ä¢	Start / end date
	‚Ä¢	Sales tab:
	‚Ä¢	Sale name
	‚Ä¢	Discount type (% / fixed)
	‚Ä¢	Discount value
	‚Ä¢	Start / end date
	‚Ä¢	Product selector (currently broken)

Broken Behavior
	‚Ä¢	Coupons ‚Äúcreate‚Äù but disappear after logout/login
	‚Ä¢	Sales cannot be created because product selector is empty
	‚Ä¢	Coupons cannot be tested in checkout
	‚Ä¢	Admin has no visibility
	‚Ä¢	No proof of DB persistence

‚∏ª

üß± REQUIRED IMPLEMENTATION (NO EXCEPTIONS)

1Ô∏è‚É£ Database Persistence (MANDATORY)

You MUST confirm or create real tables (Prisma / SQL):

Coupons
	‚Ä¢	id
	‚Ä¢	vendor_user_id (NOT vendor entity id)
	‚Ä¢	code (unique per vendor)
	‚Ä¢	name
	‚Ä¢	type (percentage | fixed)
	‚Ä¢	value
	‚Ä¢	min_order
	‚Ä¢	usage_limit
	‚Ä¢	usage_count
	‚Ä¢	starts_at
	‚Ä¢	ends_at
	‚Ä¢	is_active
	‚Ä¢	created_at

Sales
	‚Ä¢	id
	‚Ä¢	vendor_user_id
	‚Ä¢	product_id
	‚Ä¢	type (percentage | fixed)
	‚Ä¢	value
	‚Ä¢	starts_at
	‚Ä¢	ends_at
	‚Ä¢	is_active
	‚Ä¢	created_at

üö´ Do NOT store promotions in localStorage
üö´ Do NOT ‚Äúsimulate‚Äù persistence

‚∏ª

2Ô∏è‚É£ Vendor Ownership & Access Control
	‚Ä¢	Vendors may ONLY:
	‚Ä¢	Create
	‚Ä¢	View
	‚Ä¢	Edit
	‚Ä¢	Disable
their own promotions
	‚Ä¢	Vendor identity must be resolved via authenticated user_id
	‚Ä¢	No client-side trust ‚Äî server enforcement only

‚∏ª

3Ô∏è‚É£ Fix Sales Product Selector (CRITICAL)

The Select Product field MUST:
	‚Ä¢	Load products via API:
	‚Ä¢	/api/products?vendorId=<user_id>
	‚Ä¢	Use live database products
	‚Ä¢	Respect vendor ownership
	‚Ä¢	Be selectable and creatable

If no products exist, show a clear empty-state message.

‚∏ª

4Ô∏è‚É£ Admin Visibility (READ-ONLY)

Admin must be able to:
	‚Ä¢	View all coupons
	‚Ä¢	View all sales
	‚Ä¢	See vendor ownership
	‚Ä¢	See active / expired status

Admin cannot edit vendor promotions.

‚∏ª

5Ô∏è‚É£ Checkout Read-Only Wiring (NO PAYMENTS)

Do NOT implement payment logic.

You MUST:
	‚Ä¢	Allow coupon code entry at checkout
	‚Ä¢	Validate coupon via API:
	‚Ä¢	Exists
	‚Ä¢	Active
	‚Ä¢	Within date
	‚Ä¢	Usage limit not exceeded
	‚Ä¢	Min order met
	‚Ä¢	Return:
	‚Ä¢	discount amount
	‚Ä¢	updated subtotal

‚ùó If coupon invalid ‚Üí show error, do not crash

‚∏ª

üîç VERIFICATION REQUIREMENTS (MANDATORY)

You MUST manually test using THESE EXACT CREDENTIALS:

Vendor
	‚Ä¢	Email: ven@kiosk.com.gh
	‚Ä¢	Password: 123asdqwe

Buyer
	‚Ä¢	Email: buy@kiosk.com.gh
	‚Ä¢	Password: 123asdqwe

Admin
	‚Ä¢	Email: the3rdukem@gmail.com
	‚Ä¢	Password: 123asdqweX$

‚∏ª

‚úÖ REQUIRED MANUAL TESTS (NO SKIPPING)

Vendor Tests
	1.	Login as vendor
	2.	Create a coupon
	3.	Logout
	4.	Login again
	5.	Coupon MUST still exist
	6.	Create a sale
	7.	Product selector MUST list vendor products
	8.	Sale MUST persist after logout/login

Admin Tests
	1.	Login as admin
	2.	View promotions
	3.	See vendor-owned coupons and sales

Buyer Tests
	1.	Login as buyer
	2.	Add product to cart
	3.	Apply coupon code
	4.	Discount MUST reflect in subtotal
	5.	Invalid coupon MUST show error

‚∏ª

üì∏ PROOF REQUIRED IN FINAL REPORT

Your final report MUST include:
	‚Ä¢	Table schemas (or Prisma models)
	‚Ä¢	API routes used
	‚Ä¢	Confirmation of logout/login persistence
	‚Ä¢	Which pages call which APIs
	‚Ä¢	Confirmation that Zustand / localStorage is NOT used
	‚Ä¢	Confirmation that checkout reads from DB-backed promotions

If ANY section is missing ‚Üí task is NOT COMPLETE

‚∏ª

üõë FINAL WARNING

Do NOT say:
	‚Ä¢	‚ÄúWorks locally‚Äù
	‚Ä¢	‚ÄúShould work‚Äù
	‚Ä¢	‚ÄúLikely fixed‚Äù
	‚Ä¢	‚ÄúUI complete‚Äù

Only report verified, persistent, database-backed behavior.

‚∏ª

‚úÖ BEGIN IMPLEMENTATION NOW