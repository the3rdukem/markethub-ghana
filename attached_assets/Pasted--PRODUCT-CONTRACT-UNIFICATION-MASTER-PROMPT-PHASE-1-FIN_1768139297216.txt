 PRODUCT CONTRACT UNIFICATION â€” MASTER PROMPT (PHASE 1 FINAL)

ğŸš¨ READ THIS CAREFULLY â€” NO PARTIAL FIXES ALLOWED

You are entering a root-cause corrective task, not a feature task.
You must NOT add workarounds, conditional hacks, or â€œquick fixesâ€.

Your job is to UNIFY THE PRODUCT DATA CONTRACT across database â†’ API â†’ forms â†’ UI.

If any part deviates, the task is considered FAILED.

â¸»

ğŸ¯ CORE OBJECTIVE (NON-NEGOTIABLE)

There must be ONE canonical Product contract shared by:
	â€¢	Vendor Create Product
	â€¢	Vendor Edit Product
	â€¢	Admin Create Product
	â€¢	Admin Edit Product
	â€¢	Admin Product Management table
	â€¢	Search results
	â€¢	Product detail page
	â€¢	API POST / PUT / GET
	â€¢	Database persistence

No duplicate logic.
No divergent schemas.
No silent fallbacks.

â¸»

ğŸ§± STEP 1 â€” DEFINE THE CANONICAL PRODUCT CONTRACT (MANDATORY)

Create ONE shared Product schema (TypeScript + Zod) located at:

src/lib/contracts/product.contract.ts

This contract MUST define:

id
name
description
price
quantity
category (string | null)
condition (string | null)   // see Step 2
sku (string | null)
barcode (string | null)
brand (string | null)
color (string | null)
categoryAttributes (Record<string, any>)
status ('draft' | 'active')
createdAt
updatedAt

ğŸš« NO other product shape is allowed anywhere in the app.

All forms, APIs, and stores must import this contract.

â¸»

ğŸ§  STEP 2 â€” CONDITION FIELD CANONICALIZATION (CRITICAL)

You MUST make one irreversible decision:

âœ… RULE (FINAL):
	â€¢	condition is a top-level product field
	â€¢	condition is NOT allowed inside categoryAttributes
	â€¢	Categories must NEVER define condition
	â€¢	Any legacy condition inside categoryAttributes must be:
	â€¢	Migrated to top-level condition
	â€¢	Then deleted from categoryAttributes

ğŸ“Œ Enforcement:
	â€¢	Vendor form
	â€¢	Admin form
	â€¢	API POST / PUT
	â€¢	API GET normalization

If condition appears twice â†’ FAILURE

â¸»

ğŸ§¼ STEP 3 â€” READ API NORMALIZATION (MANDATORY)

Every API that returns a product MUST normalize output:
	â€¢	Empty strings â†’ null
	â€¢	Missing optional fields â†’ null
	â€¢	Never return:
	â€¢	""
	â€¢	undefined
	â€¢	invalid Select values

Especially for:
	â€¢	category
	â€¢	condition
	â€¢	sku
	â€¢	barcode

ğŸ“Œ This applies to:
	â€¢	/api/products
	â€¢	/api/products/[id]
	â€¢	Admin queries
	â€¢	Search queries

â¸»

ğŸ§¾ STEP 4 â€” ADMIN & VENDOR FORM PARITY (NO EXCEPTIONS)

Admin and Vendor product forms MUST:
	â€¢	Use the same shared form hook
	â€¢	Use React Hook Form + Controller
	â€¢	Use the same Zod schema
	â€¢	Support:
	â€¢	Draft save
	â€¢	Publish validation

REQUIRED FIELDS ON BOTH FORMS:
	â€¢	Name
	â€¢	Category
	â€¢	Condition
	â€¢	Price
	â€¢	Quantity
	â€¢	SKU
	â€¢	Barcode

ğŸš« Admin create without SKU/barcode is NOT allowed.

â¸»

ğŸ§¨ STEP 5 â€” SELECT SAFETY RULE (ABSOLUTE)

Radix Select MUST NEVER receive:
	â€¢	value=""
	â€¢	value={undefined}

You MUST use:

_unset_

as the only placeholder sentinel.

All Selects must:
	â€¢	Filter invalid values
	â€¢	Normalize on read
	â€¢	Validate on publish

If a single <Select.Item value=""> exists â†’ FAILURE

â¸»

ğŸ›¡ï¸ STEP 6 â€” VALIDATION SCOPE CORRECTION

Validation rules must follow this hierarchy:

Product Name / Business Name:

âœ… Allow:
	â€¢	â€œMercedes Benzâ€
	â€¢	â€œTheory Businessâ€
	â€¢	â€œAlpha & Sons Venturesâ€

ğŸš« Block ONLY:
	â€¢	Profanity
	â€¢	Contact info
	â€¢	URLs
	â€¢	Obvious keyboard mash

ğŸš« DO NOT apply entropy heuristics to:
	â€¢	Names
	â€¢	Addresses

â¸»

ğŸ§‘â€âš–ï¸ STEP 7 â€” ADMIN PERMISSION CONSISTENCY

Frontend must mirror backend rules:
	â€¢	Regular Admin:
	â€¢	âŒ Cannot delete Admins
	â€¢	âŒ Cannot delete Super Admin
	â€¢	Super Admin:
	â€¢	âœ… Can delete Admins they created
	â€¢	âœ… Can delete Users & Vendors

ğŸš« Do NOT show delete buttons for forbidden actions.

â¸»

ğŸ§ª STEP 8 â€” VERIFICATION (MANDATORY REPORT)

You MUST test with these accounts:

Buyer
buy@kiosk.com.gh / 123asdqwe

Vendor
ven@kiosk.com.gh / 123asdqwe

Admin
the3rdukem@gmail.com / 123asdqweX$

Your report MUST include:
	â€¢	Admin create product (draft + publish)
	â€¢	Vendor create product (draft + publish)
	â€¢	Admin edit product
	â€¢	Vendor edit product
	â€¢	SKU & barcode persistence check
	â€¢	No console errors
	â€¢	No Radix Select crashes
	â€¢	Condition saved once and only once

â¸»

âŒ STRICT FAILURE CONDITIONS

This task is FAILED if:
	â€¢	Condition exists in more than one place
	â€¢	Admin & Vendor forms differ
	â€¢	SKU/barcode still donâ€™t persist
	â€¢	Any Select crashes
	â€¢	Any product API returns empty strings
	â€¢	Admin forms reject valid product names
	â€¢	Fixes are implemented without shared contracts

â¸»

ğŸ FINAL NOTE

This is the LAST stabilization task before checkout & payments.

Do NOT rush.
Do NOT patch.
Do NOT improvise.

Unify first. Everything else depends on this.