PHASE 3 ‚Äî PAYMENT READINESS

INVESTIGATION-ONLY MASTER PROMPT

DO NOT FIX. DO NOT REFACTOR. DO NOT ADD FEATURES.
This task is READ-ONLY ANALYSIS. Any code changes will be rejected.

OBJECTIVE

Determine whether the current system is structurally safe to introduce real payments (Paystack) without data corruption, double charges, or lost orders.

‚∏ª

SCOPE (STRICT)

You are allowed to:
	‚Ä¢	Read schemas
	‚Ä¢	Read API routes
	‚Ä¢	Trace data flow (cart ‚Üí checkout ‚Üí order)
	‚Ä¢	Report findings

You are NOT allowed to:
	‚Ä¢	Modify code
	‚Ä¢	Add validation
	‚Ä¢	Rename fields
	‚Ä¢	‚ÄúImprove‚Äù anything

‚∏ª

PART A ‚Äî ORDER DATA MODEL (MANDATORY)

Inspect the orders table / model and report:
	1.	Full list of fields
	2.	Field types
	3.	Nullable vs non-nullable
	4.	Default values

Explicitly confirm the existence (or absence) of:
	‚Ä¢	order.id
	‚Ä¢	buyer_id
	‚Ä¢	status (ENUM preferred)
	‚Ä¢	total_amount
	‚Ä¢	currency
	‚Ä¢	created_at
	‚Ä¢	updated_at

üö® Call out immediately if:
	‚Ä¢	Total is computed dynamically
	‚Ä¢	There is only isPaid: boolean
	‚Ä¢	Currency is missing
	‚Ä¢	Status is free-text

‚∏ª

PART B ‚Äî ORDER ITEMS SNAPSHOT

Inspect order_items (or equivalent).

Confirm whether each item stores:
	‚Ä¢	product_id
	‚Ä¢	product_name_snapshot
	‚Ä¢	price_snapshot
	‚Ä¢	quantity
	‚Ä¢	vendor_id

Explicitly answer:
	‚Ä¢	Are prices copied at checkout?
	‚Ä¢	Do order items depend on live product data?

üö® Flag if any historical order could change due to product edits or deletion.

‚∏ª

PART C ‚Äî CART ‚Üí ORDER BOUNDARY

Trace the checkout flow step by step:
	1.	Where cart lives (DB / local / hybrid)
	2.	When order is created
	3.	When cart becomes irrelevant

Answer YES / NO:
	‚Ä¢	Can cart change after order creation?
	‚Ä¢	Is order created before payment?
	‚Ä¢	Can checkout be resumed after refresh?

‚∏ª

PART D ‚Äî PROMOTIONS & DISCOUNTS

Inspect how coupons and sales are applied.

Confirm:
	‚Ä¢	Is coupon code saved on order?
	‚Ä¢	Is discount amount saved on order?
	‚Ä¢	Is total_amount final at order creation?

üö® Flag if discounts are:
	‚Ä¢	Recalculated at render time
	‚Ä¢	Revalidated after payment

‚∏ª

PART E ‚Äî INVENTORY CHECK (AWARENESS ONLY)

Document:
	‚Ä¢	When inventory is checked
	‚Ä¢	What happens if stock changes mid-checkout

Do not propose fixes.

‚∏ª

PART F ‚Äî PAYMENT READINESS (NO PAYSTACK YET)

Confirm whether there is a place to store:
	‚Ä¢	payment_reference
	‚Ä¢	payment_status
	‚Ä¢	paid_at
	‚Ä¢	payment_provider

üö® Flag if payment data is frontend-only.

‚∏ª

PART G ‚Äî FAILURE STATES

Verify the system can represent:
	‚Ä¢	Abandoned checkout
	‚Ä¢	Failed payment
	‚Ä¢	Successful payment with delayed confirmation

üö® Flag if browser close = order lost.

‚∏ª

OUTPUT FORMAT (MANDATORY)

Respond with ONLY:

Phase 3 Payment Readiness Report

A. Orders Model
- Findings:
- Risks:

B. Order Items
- Findings:
- Risks:

C. Cart ‚Üí Order Boundary
- Findings:
- Risks:

D. Promotions
- Findings:
- Risks:

E. Inventory
- Findings:
- Risks:

F. Payment Storage
- Findings:
- Risks:

G. Failure States
- Findings:
- Risks:

FINAL VERDICT:
GO / NO-GO FOR PAYSTACK

No recommendations unless NO-GO.

‚∏ª

üßæ PHASE 3 ‚Äî ORDER SCHEMA SANITY CHECK (YOU VERIFY)

Use this manual checklist against your current schema.

ORDERS

‚úî id (UUID / serial)
‚úî buyer_id
‚úî status (enum: pending, awaiting_payment, paid, failed, cancelled)
‚úî total_amount (number, immutable)
‚úî currency (GHS)
‚úî created_at

‚ùå No derived totals
‚ùå No frontend-only state

‚∏ª

ORDER_ITEMS

‚úî product_id
‚úî product_name_snapshot
‚úî price_snapshot
‚úî quantity
‚úî vendor_id

‚ùå No live price dependency

‚∏ª

PAYMENT (can be nullable for now)

‚úî payment_reference
‚úî payment_status
‚úî payment_provider
‚úî paid_at

‚∏ª

FLOW GUARANTEE

‚úî Order exists before payment
‚úî Refresh does not destroy order
‚úî Webhook can update order later

‚∏ª

üîí IMPORTANT NOTE (READ THIS)

If ANY ONE of the following is true:
	‚Ä¢	Order total can change after creation
	‚Ä¢	Order doesn‚Äôt exist before payment
	‚Ä¢	Discounts recalculate dynamically
	‚Ä¢	Payment result has nowhere to persist

üëâ PAYSTACK WILL FAIL SILENTLY OR FATALLY

‚∏ª