
ğŸ” PHASE 3 â€” PAYMENT READINESS

INVESTIGATION-ONLY MASTER PROMPT

DO NOT FIX. DO NOT REFACTOR. DO NOT ADD FEATURES.
This task is READ-ONLY ANALYSIS. Any code changes will be rejected.

OBJECTIVE

Determine whether the current system is structurally safe to introduce real payments (Paystack) without data corruption, double charges, or lost orders.

â¸»

SCOPE (STRICT)

You are allowed to:
	â€¢	Read schemas
	â€¢	Read API routes
	â€¢	Trace data flow (cart â†’ checkout â†’ order)
	â€¢	Report findings

You are NOT allowed to:
	â€¢	Modify code
	â€¢	Add validation
	â€¢	Rename fields
	â€¢	â€œImproveâ€ anything

â¸»

PART A â€” ORDER DATA MODEL (MANDATORY)

Inspect the orders table / model and report:
	1.	Full list of fields
	2.	Field types
	3.	Nullable vs non-nullable
	4.	Default values

Explicitly confirm the existence (or absence) of:
	â€¢	order.id
	â€¢	buyer_id
	â€¢	status (ENUM preferred)
	â€¢	total_amount
	â€¢	currency
	â€¢	created_at
	â€¢	updated_at

ğŸš¨ Call out immediately if:
	â€¢	Total is computed dynamically
	â€¢	There is only isPaid: boolean
	â€¢	Currency is missing
	â€¢	Status is free-text

â¸»

PART B â€” ORDER ITEMS SNAPSHOT

Inspect order_items (or equivalent).

Confirm whether each item stores:
	â€¢	product_id
	â€¢	product_name_snapshot
	â€¢	price_snapshot
	â€¢	quantity
	â€¢	vendor_id

Explicitly answer:
	â€¢	Are prices copied at checkout?
	â€¢	Do order items depend on live product data?

ğŸš¨ Flag if any historical order could change due to product edits or deletion.

â¸»

PART C â€” CART â†’ ORDER BOUNDARY

Trace the checkout flow step by step:
	1.	Where cart lives (DB / local / hybrid)
	2.	When order is created
	3.	When cart becomes irrelevant

Answer YES / NO:
	â€¢	Can cart change after order creation?
	â€¢	Is order created before payment?
	â€¢	Can checkout be resumed after refresh?

â¸»

PART D â€” PROMOTIONS & DISCOUNTS

Inspect how coupons and sales are applied.

Confirm:
	â€¢	Is coupon code saved on order?
	â€¢	Is discount amount saved on order?
	â€¢	Is total_amount final at order creation?

ğŸš¨ Flag if discounts are:
	â€¢	Recalculated at render time
	â€¢	Revalidated after payment

â¸»

PART E â€” INVENTORY CHECK (AWARENESS ONLY)

Document:
	â€¢	When inventory is checked
	â€¢	What happens if stock changes mid-checkout

Do not propose fixes.

â¸»

PART F â€” PAYMENT READINESS (NO PAYSTACK YET)

Confirm whether there is a place to store:
	â€¢	payment_reference
	â€¢	payment_status
	â€¢	paid_at
	â€¢	payment_provider

ğŸš¨ Flag if payment data is frontend-only.

â¸»

PART G â€” FAILURE STATES

Verify the system can represent:
	â€¢	Abandoned checkout
	â€¢	Failed payment
	â€¢	Successful payment with delayed confirmation

ğŸš¨ Flag if browser close = order lost.

â¸»

OUTPUT FORMAT (MANDATORY)

Respond with ONLY:

Phase 3 Payment Readiness Report

A. Orders Model
- Findings:
- Risks:

B. Order Items
- Findings:
- Risks:

C. Cart â†’ Order Boundary
- Findings:
- Risks:

D. Promotions
- Findings:
- Risks:

E. Inventory
- Findings:
- Risks:

F. Payment Storage
- Findings:
- Risks:

G. Failure States
- Findings:
- Risks:

FINAL VERDICT:
GO / NO-GO FOR PAYSTACK

No recommendations unless NO-GO.

â¸»

ğŸ§¾ PHASE 3 â€” ORDER SCHEMA SANITY CHECK (YOU VERIFY)

Use this manual checklist against your current schema.

ORDERS

âœ” id (UUID / serial)
âœ” buyer_id
âœ” status (enum: pending, awaiting_payment, paid, failed, cancelled)
âœ” total_amount (number, immutable)
âœ” currency (GHS)
âœ” created_at

âŒ No derived totals
âŒ No frontend-only state

â¸»

ORDER_ITEMS

âœ” product_id
âœ” product_name_snapshot
âœ” price_snapshot
âœ” quantity
âœ” vendor_id

âŒ No live price dependency

â¸»

PAYMENT (can be nullable for now)

âœ” payment_reference
âœ” payment_status
âœ” payment_provider
âœ” paid_at

â¸»

FLOW GUARANTEE

âœ” Order exists before payment
âœ” Refresh does not destroy order
âœ” Webhook can update order later

â¸»

ğŸ”’ IMPORTANT NOTE (READ THIS)

If ANY ONE of the following is true:
	â€¢	Order total can change after creation
	â€¢	Order doesnâ€™t exist before payment
	â€¢	Discounts recalculate dynamically
	â€¢	Payment result has nowhere to persist

ğŸ‘‰ PAYSTACK WILL FAIL SILENTLY OR FATALLY

â¸»